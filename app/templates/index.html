<!DOCTYPE html>
<html lang="uk" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Mega Exchange</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-dark text-light">

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded bg-secondary bg-opacity-10 border border-secondary">
        <div>
            <h1 class="text-warning mb-0">üöÄ MegaExchange</h1>
            <small class="text-muted">–ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª</small>
        </div>
        <div class="text-end">
            <h4>–ö—É—Ä—Å BTC: <span class="badge bg-info">{{ price }} $</span></h4>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card border-warning mb-4 shadow">
                <div class="card-header bg-warning text-dark fw-bold">üíº –ú—ñ–π –ü–æ—Ä—Ç—Ñ–µ–ª—å</div>
                <div class="card-body">
                    <p class="fs-4 mb-1">üíµ {{ wallet.balance_usd | round(2) }} USD</p>
                    <p class="fs-4 text-warning">‚Çø {{ wallet.balance_btc | round(5) }} BTC</p>
                </div>
            </div>

            <div class="card border-success shadow mb-3">
                <div class="card-header bg-success text-white fw-bold">üõí –ö—É–ø–∏—Ç–∏ BTC</div>
                <div class="card-body">
                    <form action="/buy" method="post">
                        <div class="mb-3">
                            <label class="form-label text-light">–°—É–º–∞ —ñ–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó ($)</label>
                            <input type="number" name="amount" class="form-control bg-dark text-light border-secondary" placeholder="500" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100 btn-lg">–ö—É–ø–∏—Ç–∏ –º–∏—Ç—Ç—î–≤–æ</button>
                    </form>
                </div>
            </div>

            <div class="card border-danger shadow">
                <div class="card-header bg-danger text-white fw-bold">üìâ –ü—Ä–æ–¥–∞—Ç–∏ BTC</div>
                <div class="card-body">
                    <form action="/sell" method="post">
                        <div class="mb-3">
                            <label class="form-label text-light">–û—Ç—Ä–∏–º–∞—Ç–∏ ($)</label>
                            <input type="number" name="amount" class="form-control bg-dark text-light border-secondary" placeholder="500" required>
                        </div>
                        <button type="submit" class="btn btn-danger w-100 btn-lg">–ü—Ä–æ–¥–∞—Ç–∏ –º–∏—Ç—Ç—î–≤–æ</button>
                    </form>
                </div>
            </div>

        </div>

        <div class="col-md-8">
            <div class="card mb-4 bg-dark border-secondary shadow">
                <div class="card-body">
                    <canvas id="btcChart" height="120"></canvas>
                </div>
            </div>
            
            <h5 class="border-bottom pb-2 border-secondary">üìú –û—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h5>
            <div class="table-responsive">
                <table class="table table-dark table-striped table-hover mt-2">
                    <thead>
                        <tr>
                            <th>–ß–∞—Å</th>
                            <th>–î—ñ—è</th>
                            <th>USD ($)</th>
                            <th>BTC (‚Çø)</th>
                            <th>–ö—É—Ä—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx in history %}
                        <tr>
                            <td>{{ tx.timestamp.strftime('%H:%M:%S') }}</td>
                            <td>
                                {% if tx.amount_usd > 0 %}
                                    <span class="badge bg-success">–ö–£–ü–Ü–í–õ–Ø</span>
                                {% else %}
                                    <span class="badge bg-danger">–ü–†–û–î–ê–ñ</span>
                                {% endif %}
                            </td>
                            <td class="{% if tx.amount_usd < 0 %}text-success{% else %}text-danger{% endif %}">
                                {% if tx.amount_usd > 0 %}-{% else %}+{% endif %}{{ tx.amount_usd | abs | round(2) }}
                            </td>
                            <td class="{% if tx.amount_btc > 0 %}text-success{% else %}text-danger{% endif %}">
                                {% if tx.amount_btc > 0 %}+{% else %}-{% endif %}{{ tx.amount_btc | abs | round(5) }}
                            </td>
                            <td>{{ tx.price_at_moment | round(2) }} $</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% if not history %}
                    <p class="text-center text-muted mt-3">–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫–∏ –ø–æ—Ä–æ–∂–Ω—è. –ó—Ä–æ–±—ñ—Ç—å –ø–µ—Ä—à—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é!</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    // –ú–∞–ª—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫
    const ctx = document.getElementById('btcChart').getContext('2d');
    const chartData = {{ chart_data }}; 
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['10m', '9m', '8m', '7m', '6m', '5m', '4m', '3m', '2m', 'Now'],
            datasets: [{
                label: 'Bitcoin Price (USD)',
                data: chartData,
                borderColor: '#ffc107', 
                borderWidth: 2,
                tension: 0.4, 
                fill: true,
                backgroundColor: 'rgba(255, 193, 7, 0.1)'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                title: { display: true, text: '–î–∏–Ω–∞–º—ñ–∫–∞ —Ä–∏–Ω–∫—É (Simulated)', color: '#fff' }
            },
            scales: {
                x: { grid: { color: '#333' } },
                y: { grid: { color: '#333' } }
            }
        }
    });
</script>

</body>
</html>